<!doctype html>
<html lang="zh-CN" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TrendRadar</title>
  <style>
    :root{
      --bg:#0b1020; --fg:#e6edf3; --muted:#9aa4b2; --border:#20304a;
      --btn:#3b82f6; --btnfg:#fff;
      --chip:#111827; --chipfg:#cbd5e1;
    }
    html[data-theme="light"]{
      --bg:#f6f8fa; --fg:#0f172a; --muted:#667085; --border:#e5e7eb;
      --btn:#2563eb; --btnfg:#fff;
      --chip:#f3f4f6; --chipfg:#334155;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:var(--fg); font:14px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;}
    header{ position:sticky; top:0; z-index:50; background: color-mix(in srgb, var(--bg) 86%, transparent); backdrop-filter: blur(10px) saturate(160%); border-bottom:1px solid var(--border); }
    .bar{ height:56px; padding:0 12px; max-width:1400px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .title{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .title strong{ font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .title span{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .right{ display:flex; align-items:center; gap:10px; }
    .chip{ font-size:12px; color:var(--chipfg); background:var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px; }
    .btn{ border:1px solid var(--border); background:transparent; color:var(--fg); padding:8px 10px; border-radius:10px; cursor:pointer; }
    .btn.primary{ background:var(--btn); border-color:transparent; color:var(--btnfg); }
    .frame{ width:100%; height:calc(100vh - 56px); border:0; overflow:hidden; }
    iframe{ width:100%; height:100%; border:0; background:transparent; }
    @media (max-width:520px){ .chip{display:none;} .title span{display:none;} }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="title">
        <strong>TrendRadar</strong>
        <span>深浅色可切换；内容由 GitHub Actions 定时生成</span>
      </div>
      <div class="right">
        <span class="chip" id="status">报告：加载中…</span>
        <button class="btn" id="toggle">浅色</button>
        <button class="btn primary" id="refresh">刷新</button>
      </div>
    </div>
  </header>

  <div class="frame">
    <iframe id="report" src="./report.html" title="TrendRadar Report"></iframe>
  </div>

  <script>
    const root = document.documentElement;
    const toggleBtn = document.getElementById('toggle');
    const refreshBtn = document.getElementById('refresh');
    const frame = document.getElementById('report');
    const status = document.getElementById('status');

    function applyTheme(theme){
      root.dataset.theme = theme;
      localStorage.setItem('theme', theme);
      toggleBtn.textContent = theme === 'dark' ? '浅色' : '深色';
    }

    applyTheme(localStorage.getItem('theme') || 'dark');

    toggleBtn.addEventListener('click', () => {
      const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
      applyTheme(next);
      // 为确保 iframe 100% 同步主题，这里刷新一次 report
      frame.src = './report.html?ts=' + Date.now();
    });

    refreshBtn.addEventListener('click', () => {
      status.textContent = '报告：刷新中…';
      frame.src = './report.html?ts=' + Date.now();
    });

    frame.addEventListener('load', () => { status.textContent = '报告：已加载'; });
  </script>
</body>
</html>
